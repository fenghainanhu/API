<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <title>[置顶]
        linux内核3.4基于wakeup_source的autosleep机制分析_Linux_IThao123 - IT行业第一站</title>
    <meta name="keywords" content="[置顶]
        linux内核3.4基于wakeup_source的autosleep机制分析" />
    <meta name="description" content="[置顶]
        linux内核3.4基于wakeup_source的autosleep机制分析_一：wakeup_source简介： linux 3.4内核PM使用了wakeup_source来保持唤醒状态，也就是keep awake。之前android一直是基于Linux加入了wake_lock机制来阻止系统休眠，后来Linux 3.4内核加入了wakeup_source来管" />

    <meta name="mobile-agent"content="format=[wml|xhtml|html5]; url=http://m.ithao123.cn/content-943843.html">
    <link href="http://m.ithao123.cn/content-943843.html" rel="alternate" media="only screen and (max-width: 640px)" />

    <meta name="applicable-device" content="pc">

    <link rel="stylesheet" type="text/css" href="/statics/zhuanti/css/base.css" media="all">
    <link rel="stylesheet" type="text/css" href="/statics/zhuanti/css/footer.css" media="all">
	
	<script src="http://www.ithao123.cn/statics/uaredirect.js"></script>
	
	<script type="text/javascript">uaredirect("http://m.ithao123.cn/content-943843.html");</script>



    <script>

        var IS_LOGIN 	= "";
        var LEIPHONE_HOME_URL = USER_CENTER  = "http://zhuanti.ithao123.cn/";
		
    </script>

    <!--[if IE]>
    <script>
        (function(){var e="abbr, article, aside, audio, canvas, datalist, details, dialog, eventsource, figure, footer, header, hgroup, mark, menu, meter, nav, output, progress, section, time, video".split(', ');var i=e.length;while(i--){document.createElement(e[i])}})()
    </script>
    <![endif]-->

    <script src="http://www.ithao123.cn/statics/zhuanti/js/sea.js"></script>
    <script src="http://www.ithao123.cn/statics/zhuanti/js/jquery.js"></script>
    <script src="http://www.ithao123.cn/statics/zhuanti/js/tips.js"></script>
    <link rel="stylesheet" href="http://www.ithao123.cn/statics/zhuanti/css/tips.css">
<!--
    <script src="http://www.ithao123.cn/statics/zhuanti/js/global.js"></script>
    -->
    <script>
        seajs.use('http://www.ithao123.cn/statics/zhuanti/js/global.js',function(){
        });
    </script>

    <!--
    <script src="/statics/zhuanti/js/sea.js"></script>
    <script src="/statics/zhuanti/js/jquery.js"></script>
    -->

    <link rel="stylesheet" href="/statics/zhuanti/css/yp_login.css">
    <link rel="stylesheet" href="http://bdimg.share.baidu.com/static/api/css/share_style0_16.css?v=8105b07e.css">
</head>
<body>


<div class="header">
    <div class="w1200 auto">
        <div class="header_nav">
            <ul>
                <li><a href="http://www.ithao123.cn/">IThao123首页</a></li>
                <li><a href="http://m.ithao123.cn">手机版</a></li>
                <!--
                <li>
                    <a href="#"><span class="l">网站导航</span><i class="r"></i></a>
                </li>

                <li><a href="#" rel="nofollow">帮助中心</a></li>
                -->

            </ul>
        </div>
        <div class="header_login">
            欢迎来到IThao123.cn！
            			            您尚未 [&nbsp;<a href="/index.php?m=member&amp;c=index&amp;a=login" class="red" rel="nofollow">登录</a>&nbsp;]
            或 [&nbsp;<a href="/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1" class="red" rel="nofollow">注册</a>&nbsp;]
                    </div>
    </div>
</div>



<header class="yp-header">
    <div class="yp-header-top  inner clr">
        <a class="yp-header-logo" href="http://www.ithao123.cn">
            <img src="http://www.ithao123.cn/statics/zhuanti/images/lp_logo.png" height="52" alt="logo">
            <span style="color:#DC6E4B;">
				&nbsp;&nbsp;&nbsp;专注互联网行业
			</span>
        </a>
        <!--
        <div class="yp-header-user-box">
            <div class="yp-header-user"><input type="hidden" id="is_login_tag_status" value="0"><div class="user-main"><div class="avatar"><img width="36" height="36" src="/statics/zhuanti/images/noLogin.jpg" alt=""></div><span class="nickname">用户</span><span class="arrow"></span></div><div class="user-link"><ul><li class="l1"><a href="javascript:YP_LOGIN_WINDOW.show();"><i></i>登录</a></li><li class="l2"><a href="http://home.ithao123.cn/main/register?returnUrl=http%3A%2F%2Fwww.ithao123.cn%2Fcategory%2Fzixun"><i></i>注册</a></li></ul></div></div>
        </div>
        -->
        <div class="yp-header-search">
            <form method="GET" action="" style="height: 100%;">
                <input class="text" type="text" id="searchq" name="q" autocomplete="off" value="">
                <input class="submit" type="botton" id="searchbtn" value="">
            </form>
        </div>
    </div>


    <nav class="yp-header-nav" id="yp-header-nav">
        <div class="inner clr">
            <div class="yp-header-menu">
                <span class="arrow" style="left: 35px; display: block;"></span>
                <ul>
                    <li><a href="http://www.ithao123.cn">首页</a></li>
                    <li class="ej" data-dl="newsDl"><a href="http://zixun.ithao123.cn">资讯<span class="arro"></span></a>
                        <div class="news-menu">
                                                        <div class="dline">
                                                                                                                                <a href="http://www.ithao123.cn/news/dashuju/">大数据</a><span>|</span>
                                                                                                                                                                                                <a href="http://www.ithao123.cn/news/yejie/">业界</a><span>|</span>
                                                                                                                                                                                                <a href="http://www.ithao123.cn/news/shouji/">移动互联</a><span>|</span>
                                                                                                                                                                                                <a href="http://www.ithao123.cn/news/chuangye/">创业</a><span>|</span>
                                                                                                                                                                                                <a href="http://www.ithao123.cn/news/touzi/">投资</a><span>|</span>
                                                                                                                                                                                                <a href="http://www.ithao123.cn/news/jiaoyu/">IT教育</a><span>|</span>
                                                                                                                                                                                                <a href="http://www.ithao123.cn/news/wangluo/">网络</a><span>|</span>
                                                                                                                                                                                                <a href="http://www.ithao123.cn/news/anquan/">安全</a><span>|</span>
                                                                                                                                                                                                <a href="http://www.ithao123.cn/news/jishu/">技术</a><span>|</span>
                                                                </div><div class='dline'>                                                                                                                                <a href="http://www.ithao123.cn/news/chanpin/">产品</a><span>|</span>
                                                                                                                                                                                                <a href="http://www.ithao123.cn/news/yunying/">运营</a><span>|</span>
                                                                                                                                                                                                <a href="http://www.ithao123.cn/news/dianshang/">电子商务</a><span>|</span>
                                                                                                                                                                                                <a href="http://www.ithao123.cn/news/pingce/">评测攻略</a><span>|</span>
                                                                                                                                                                                                <a href="http://www.ithao123.cn/news/sheji/">设计</a><span>|</span>
                                                                                                                                                                                                <a href="http://www.ithao123.cn/news/youxi/">游戏</a><span>|</span>
                                                                                                                                                            </div>
                            
                        </div>
                    </li>
                    <li class="ej"><a href="http://zhuanti.ithao123.cn">专题<span class="arro"></span></a>

                        <div class="news-menu">
                            <div class="dline">
                                <a href="http://zhuanti.ithao123.cn/jishu/">技术</a><span>|</span>
                                <a href="http://zhuanti.ithao123.cn/chanpin/">产品</a><span>|</span>
                                <a href="http://zhuanti.ithao123.cn/yunying/">运营</a><span>|</span>
                                <a href="http://zhuanti.ithao123.cn/zhanzhang/">站长学院</a><span>|</span>
                            </div>
                        </div>
                    </li>
                    <li><a href="http://zhoukan.ithao123.cn">周刊</a></li>
                    <li class="ej"><a href="http://jishu.ithao123.cn">技术<span class="arro"></span></a>


                        <div class="news-menu">
                                                                <div class="dline">
                                                                                                                                                <a href="http://biancheng.ithao123.cn">编程</a><span>|</span>
                                                                                                                                                                                                                <a href="http://yidong.ithao123.cn">移动开发</a><span>|</span>
                                                                                                                                                                                                                <a href="http://web.ithao123.cn">web开发</a><span>|</span>
                                                                                                                                                                                                                <a href="http://db.ithao123.cn">架构存储</a><span>|</span>
                                                                                                                                                                                                                <a href="http://yun.ithao123.cn">云计算</a><span>|</span>
                                                                                                                                                                                                                <a href="http://wangluo.ithao123.cn">网络安全</a><span>|</span>
                                                                                                                                                                                                                <a href="http://xitong.ithao123.cn">系统</a><span>|</span>
                                                                                                                                                                         </div>
                                
                        </div>

                    </li>
                    <li class="ej"><a href="http://chanpin.ithao123.cn">产品<span class="arro"></span></a>
                        <div class="news-menu">

                                                                <div class="dline">
                                                                                                                                                <a href="http://www.ithao123.cn/chanpin/sheji/">产品设计</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/chanpin/tiyan/">用户体验</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/chanpin/seo/">SEO优化</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/chanpin/youhua/">产品优化</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/chanpin/guanli/">产品管理</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/chanpin/xuqiu/">需求分析</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/chanpin/wendang/">产品文档</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/chanpin/gongju/">常用工具</a><span>|</span>
                                                                        </div><div class='dline'>                                                                                                                                        <a href="http://www.ithao123.cn/chanpin/xiangmu/">项目管理</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/chanpin/yonghudiaoyan/">用户调研</a><span>|</span>
                                                                                                                                                                    </div>
                                


                        </div>
                    </li>
                    <li class="ej"><a href="http://yunying.ithao123.cn">运营<span class="arro"></span></a>

                        <div class="news-menu">

                                                                <div class="dline">
                                                                                                                                                <a href="http://www.ithao123.cn/yunying/chanpin/">产品运营</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/yunying/cehua/">运营策划</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/yunying/shangye/">商业产品运营</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/yunying/wangzhan/">网站运营</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/yunying/yonghu/">用户运营</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/yunying/neirong/">内容运营</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/yunying/guanxi/">关系运营</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/yunying/app/">APP运营</a><span>|</span>
                                                                        </div><div class='dline'>                                                                                                                                        <a href="http://www.ithao123.cn/yunying/dianshang/">电商运营</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/yunying/shequ/">社区运营</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/yunying/shichang/">市场运营</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/yunying/qudao/">渠道运营</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/yunying/huati/">话题运营</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/yunying/huodong/">活动运营</a><span>|</span>
                                                                                                                                                                                                                <a href="http://www.ithao123.cn/yunying/youxiyunying/">游戏运营</a><span>|</span>
                                                                                                                                                                    </div>
                                


                        </div>
                    </li>
                    <li class="ej"><a href="http://sheji.ithao123.cn/">设计<span class="arro"></span></a>

                        <div class="news-menu">

                                                        <div class="dline">
                                                                                                                                <a href="http://www.ithao123.cn/sheji/tiyan/">用户体验设计</a><span>|</span>
                                                                                                                                                                                        <a href="http://www.ithao123.cn/sheji/jiaohu/">交互设计</a><span>|</span>
                                                                                                                                                                                        <a href="http://www.ithao123.cn/sheji/jiemian/">用户界面设计</a><span>|</span>
                                                                                                                                                                                        <a href="http://www.ithao123.cn/sheji/shijue/">视觉设计</a><span>|</span>
                                                                                                                                                                                        <a href="http://www.ithao123.cn/sheji/sheying/">摄影教程</a><span>|</span>
                                                                                                                                                                                        <a href="http://www.ithao123.cn/sheji/ps/">photoshop教程</a><span>|</span>
                                                                </div><div class='dline'>                                                                                                                        <a href="http://www.ithao123.cn/sheji/fireworks/">Fireworks教程</a><span>|</span>
                                                                                                                                                                                        <a href="http://www.ithao123.cn/sheji/coreldraw/">CorelDraw教程</a><span>|</span>
                                                                                                                                                                                        <a href="http://www.ithao123.cn/sheji/illustrator/">Illustrator教程</a><span>|</span>
                                                                                                                                                                                        <a href="http://www.ithao123.cn/sheji/painter/">Painter教程</a><span>|</span>
                                                                                                                                                                                        <a href="http://www.ithao123.cn/sheji/freehand/">Freehand教程</a><span>|</span>
                                                                                                                                                                                        <a href="http://www.ithao123.cn/sheji/indesign/">Indesign</a><span>|</span>
                                                                </div><div class='dline'>                                                                                </div>
                            


                        </div>
                    </li>
                    <!--
                    <li><a href="http://www.wenda114.com/c-10001/" target="_blank">问答</a></li>
                    <li><a href="http://www.wocaiwang.cn" target="_blank">培训</a></li>
                    <li><a href="http://www.ithao123.cn/huodong/" rel="nofollow">活动</a></li>
                    <li><a href="#" rel="nofollow">招聘</a></li>
                    -->
                </ul>

            </div>

        </div>
    </nav>



</header>

<link rel="stylesheet" type="text/css" href="/statics/zhuanti/css/article.css" media="all">
<link rel="stylesheet" type="text/css" href="/statics/zhuanti/css/artCont_web_admin.css" media="all">

<div class="index-main lph-main clr">
    <div class="inner">

        <div>
            <a href="http://www.ithao123.cn">首页</a><span> &gt; </span>
                                                <a href="http://www.ithao123.cn/jishu/">技术</a><span> &gt; </span>
                        <a href="http://www.ithao123.cn/xitong/">系统</a><span> &gt; </span>
                        <a href="http://www.ithao123.cn/xitong/linux/">Linux</a><span> &gt; </span>
                                    [置顶]
        linux内核3.4基于wakeup_source的autosleep机制分析        </div>
        <div class="article-left lph-left">
		
		<div style="width: 100%;float: left;margin-top: 10px;margin-bottom: 10px;clear: both;">
			
				<div style="width: 780px;float: left;">
                    <script type="text/javascript">
                        var cpro_id="u2313137";
                        (window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"780",rsi1:"90",pat:"1",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"0",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"14",rss2:"#000000",titSU:"0",tft:"0",tlt:"1",ptbg:"90",piw:"0",pih:"0",ptp:"0"}
                    </script>
                    <script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
                </div>
		
				
				<div style="width:780px;text-align:center;margin:0 auto;">
                    <script type="text/javascript">
						/*在线_IT_内容页_正文上方广告2_v2_780*90 创建于 2016-01-14*/
						var cpro_id = "u2491258";
					</script>
					<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
                </div>
				
				

            </div>
			
            <div class="pageTop">
                <h1>[置顶]
        linux内核3.4基于wakeup_source的autosleep机制分析</h1>
            </div>


            
            <div class="pageCont lph-article-comView ">

				
				[摘要：一：wakeup_source简介： linux 3.4内核PM应用了wakeup_source去坚持叫醒状况，也便是keep awake。之前android不停是基于Linux到场了wake_lock机造去阻拦体系戚眠，厥后Linux 3.4内核到场了wakeup_source去管] <br>
				
				<div>
				<script type="text/javascript">
				var cpro_id="u2571011";
				(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"760",rsi1:"160",pat:"1",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"0",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"14",rss2:"#000000",titSU:"0",tft:"0",tlt:"0",ptbg:"90",piw:"120",pih:"70",ptp:"0"}
				</script>
				<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
				</div>
				<br>
				
	
                <p><strong><span style="font-size:18px">一：wakeup_source简介：</span></strong></p>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;linux 3.4内核PM使用了wakeup_source来保持唤醒状态，也就是keep awake。之前android一直是基于Linux加入了wake_lock机制来阻止系统休眠，后来Linux 3.4内核加入了wakeup_source来管理，安卓4.4跟着升级内核也就摒弃了自己的臃肿的wake_lock机制，在对上层接口并不改变，在内核wake_lock实现直接基于wakeup_source来实现的。当然也会带来debug上的一些问题，比如以前的wake_lock自身带有强大的debug信息，那么我们在调试的时候可以自己看见dmesg中默认打印active   wake lock XXX，很直观来辨别需要休眠的时候那个wake lock有问题阻止了休眠。这个需要我们自己来完善。个人认为改进很大，现在使用了autosleep机制，只要不存在任何active wakeup_source了，系统自动休眠，当有active wake_source自动block住，个人认为休眠更及时，非休眠时间在减少，同时不会消耗额外的资源。使用基于queue work与进程block来管理suspend。还有这里的wakeup_source个人觉得应该叫keepawake_source或者stayawake_souce，毕竟系统的唤醒也就是cpu的再次运行是由中断唤醒的而不是wakeup_source。同时安卓4.4还有一个重大改变就是去除了early   suspend机制改为fb event通知机制。那么现在就只有suspend与resume,runtime suspend与runtime resume了。</span><br>  <br>  <br>  <span style="font-size:14px">/**</span><br>  <span style="font-size:14px">&nbsp;* struct wakeup_source - Representation of wakeup sources</span><br>  <span style="font-size:14px">&nbsp;*</span><br>  <span style="font-size:14px">&nbsp;* @total_time: Total time this wakeup source has been active.</span><br>  <span style="font-size:14px">&nbsp;* @max_time: Maximum time this wakeup source has been continuously active.</span><br>  <span style="font-size:14px">&nbsp;* @last_time: Monotonic clock when the wakeup source's was touched last time.</span><br>  <span style="font-size:14px">&nbsp;* @prevent_sleep_time: Total time this source has been preventing autosleep.</span><br>  <span style="font-size:14px">&nbsp;* @event_count: Number of signaled wakeup events.</span><br>  <span style="font-size:14px">&nbsp;* @active_count: Number of times the wakeup sorce was activated.</span><br>  <span style="font-size:14px">&nbsp;* @relax_count: Number of times the wakeup sorce was deactivated.</span><br>  <span style="font-size:14px">&nbsp;* @expire_count: Number of times the wakeup source's timeout has expired.</span><br>  <span style="font-size:14px">&nbsp;* @wakeup_count: Number of times the wakeup source might abort suspend.</span><br>  <span style="font-size:14px">&nbsp;* @active: Status of the wakeup source.</span><br>  <span style="font-size:14px">&nbsp;* @has_timeout: The wakeup source has been activated with a timeout.</span><br>  <span style="font-size:14px">&nbsp;*/</span><br>  <span style="font-size:14px">struct wakeup_source {</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;const char &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;*name;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;struct list_head&nbsp;&nbsp; &nbsp;entry;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;struct list_head&nbsp;&nbsp; &nbsp;list;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;spinlock_t&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;lock;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;struct timer_list&nbsp;&nbsp; &nbsp;timer;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;unsigned long&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;timer_expires; //超时时间，也就是wake_lock_timeout()里面的时间参数，超时后会执行deactivate函数</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;ktime_t total_time;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;ktime_t max_time;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;ktime_t last_time;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;ktime_t start_prevent_time;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;ktime_t prevent_sleep_time;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;unsigned long&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;event_count; //event计数</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;unsigned long&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;active_count;//active计数</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;unsigned long&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;relax_count;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;unsigned long&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;expire_count;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;unsigned long&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;wakeup_count;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;bool&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;active:1; //用于判断是否是active状态</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;bool&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;autosleep_enabled:1;//这个变量是来标记active等时间的</span><br>  <span style="font-size:14px">};</span><br>  <br>  <br>  <span style="font-size:14px">//active任何wakeup_source都会执行该函数，标记active为true</span><br>  <span style="font-size:14px">/**</span><br>  <span style="font-size:14px">&nbsp;* wakup_source_activate - Mark given wakeup source as active.</span><br>  <span style="font-size:14px">&nbsp;* @ws: Wakeup source to handle.</span><br>  <span style="font-size:14px">&nbsp;*</span><br>  <span style="font-size:14px">&nbsp;* Update the @ws' statistics and, if @ws has just been activated, notify the PM</span><br>  <span style="font-size:14px">&nbsp;* core of the event by incrementing the counter of of wakeup events being</span><br>  <span style="font-size:14px">&nbsp;* processed.</span><br>  <span style="font-size:14px">&nbsp;*/</span><br>  <span style="font-size:14px">static void wakeup_source_activate(struct wakeup_source *ws)</span><br>  <span style="font-size:14px">{</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;unsigned int cec;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;ws-&gt;active = true;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;ws-&gt;active_count&#43;&#43;;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;ws-&gt;last_time = ktime_get();</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (ws-&gt;autosleep_enabled)</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;ws-&gt;start_prevent_time = ws-&gt;last_time;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;/* Increment the counter of events in progress. */</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;cec = atomic_inc_return(&amp;combined_event_count);</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;trace_wakeup_source_activate(ws-&gt;name, cec);</span><br>  <span style="font-size:14px">}</span><br>  <br>  <br>  <span style="font-size:14px">//deactivate任何wakeup_source都会执行该函数，标记active为false</span><br>  <span style="font-size:14px">/**</span><br>  <span style="font-size:14px">&nbsp;* wakup_source_deactivate - Mark given wakeup source as inactive.</span><br>  <span style="font-size:14px">&nbsp;* @ws: Wakeup source to handle.</span><br>  <span style="font-size:14px">&nbsp;*</span><br>  <span style="font-size:14px">&nbsp;* Update the @ws' statistics and notify the PM core that the wakeup source has</span><br>  <span style="font-size:14px">&nbsp;* become inactive by decrementing the counter of wakeup events being processed</span><br>  <span style="font-size:14px">&nbsp;* and incrementing the counter of registered wakeup events.</span><br>  <span style="font-size:14px">&nbsp;*/</span><br>  <span style="font-size:14px">static void wakeup_source_deactivate(struct wakeup_source *ws)</span><br>  <span style="font-size:14px">{</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;unsigned int cnt, inpr, cec;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;ktime_t duration;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;ktime_t now;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;ws-&gt;relax_count&#43;&#43;;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;/*</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp; * __pm_relax() may be called directly or from a timer function.</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp; * If it is called directly right after the timer function has been</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp; * started, but before the timer function calls __pm_relax(), it is</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp; * possible that __pm_stay_awake() will be called in the meantime and</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp; * will set ws-&gt;active.&nbsp; Then, ws-&gt;active may be cleared immediately</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp; * by the __pm_relax() called from the timer function, but in such a</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp; * case ws-&gt;relax_count will be different from ws-&gt;active_count.</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp; */</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (ws-&gt;relax_count != ws-&gt;active_count) {</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;ws-&gt;relax_count--;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;}</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;ws-&gt;active = false;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;now = ktime_get();</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;duration = ktime_sub(now, ws-&gt;last_time);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;ws-&gt;total_time = ktime_add(ws-&gt;total_time, duration);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (ktime_to_ns(duration) &gt; ktime_to_ns(ws-&gt;max_time))</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;ws-&gt;max_time = duration;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;ws-&gt;last_time = now;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;del_timer(&amp;ws-&gt;timer);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;ws-&gt;timer_expires = 0;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (ws-&gt;autosleep_enabled)</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;update_prevent_sleep_time(ws, now);</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;/*</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp; * Increment the counter of registered wakeup events and decrement the</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp; * couter of wakeup events in progress simultaneously.</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp; */</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;cec = atomic_add_return(MAX_IN_PROGRESS, &amp;combined_event_count);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;trace_wakeup_source_deactivate(ws-&gt;name, cec);</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;split_counters(&amp;cnt, &amp;inpr);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (!inpr &amp;&amp; waitqueue_active(&amp;wakeup_count_wait_queue)){</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;wake_up(&amp;wakeup_count_wait_queue); //当不存在任何active wake_up source的时候唤醒try_to_suspend进程。</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;}</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;</span><br>  <span style="font-size:14px">}</span><br>  <br>  <span style="font-size:14px">wakup_source的申请与释放：</span><br>  <span style="font-size:14px">1：使用安卓的wake_lock接口：wake_lock（），wake_lock_timeout（）,wake_unlock（）;</span><br>  <span style="font-size:14px">2: 使用wakeup_source自带的接口：pm_stay_awake（）,pm_relax();这里的name就是device name。</span><br>  <br>  <strong><span style="font-size:18px">二：autosleep分析：</span></strong><br>  <p><span style="font-size:14px">sys接口：sys/power/autosleep</span></p>  <p><span style="font-size:14px">亮屏时libsuspend会写入off,灭屏写入mem</span></p>  <br>  <span style="font-size:14px">static ssize_t autosleep_show(struct kobject *kobj,</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; struct kobj_attribute *attr,</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; char *buf)</span><br>  <span style="font-size:14px">{</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;suspend_state_t state = pm_autosleep_state();</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (state == PM_SUSPEND_ON)</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return sprintf(buf, &quot;offn&quot;);</span><br>  <br>  <span style="font-size:14px">#ifdef CONFIG_SUSPEND</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (state &lt; PM_SUSPEND_MAX)</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return sprintf(buf, &quot;%sn&quot;, valid_state(state) ?</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;pm_states[state] : &quot;error&quot;);</span><br>  <span style="font-size:14px">#endif</span><br>  <span style="font-size:14px">#ifdef CONFIG_HIBERNATION</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;return sprintf(buf, &quot;diskn&quot;);</span><br>  <span style="font-size:14px">#else</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;return sprintf(buf, &quot;error&quot;);</span><br>  <span style="font-size:14px">#endif</span><br>  <span style="font-size:14px">}</span><br>  <br>  <span style="font-size:14px">static ssize_t autosleep_store(struct kobject *kobj,</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; struct kobj_attribute *attr,</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const char *buf, size_t n)</span><br>  <span style="font-size:14px">{</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;suspend_state_t state = decode_state(buf, n);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;int error;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (state == PM_SUSPEND_ON</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &amp;&amp; strcmp(buf, &quot;off&quot;) &amp;&amp; strcmp(buf, &quot;offn&quot;))</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return -EINVAL;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;error = pm_autosleep_set_state(state);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;return error ? error : n;</span><br>  <span style="font-size:14px">}</span><br>  <br>  <span style="font-size:14px">power_attr(autosleep);</span><br>  <br>  <br>  <span style="font-size:14px">int pm_autosleep_set_state(suspend_state_t state)</span><br>  <span style="font-size:14px">{</span><br>  <br>  <span style="font-size:14px">#ifndef CONFIG_HIBERNATION</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (state &gt;= PM_SUSPEND_MAX)</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return -EINVAL;</span><br>  <span style="font-size:14px">#endif</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;__pm_stay_awake(autosleep_ws); //防止系统休眠 </span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;mutex_lock(&amp;autosleep_lock);</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;autosleep_state = state;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;__pm_relax(autosleep_ws); //释放上面的wake up source</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (state &gt; PM_SUSPEND_ON) {</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;pm_wakep_autosleep_enabled(true); //设置所有wake up source里面的autosleep_enabled为真，这个变量不会对休眠有影响，但是会标记active的时间,使用debugfs可以看见</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;queue_up_suspend_work();//调度工作队列，会执行try_to_suspend（），其实state mem执行try_to_suspend（），一次就可以了，后面再分析。</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;} else {</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;pm_wakep_autosleep_enabled(false);//设置所有wake up source里面的autosleep_enabled为假</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;}</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;mutex_unlock(&amp;autosleep_lock);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;return 0;</span><br>  <span style="font-size:14px">}</span><br>  <br>  <br>  <span style="font-size:14px">重头戏：try_to_suspend</span><br>  <br>  <span style="font-size:14px">static void try_to_suspend(struct work_struct *work)</span><br>  <span style="font-size:14px">{</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;unsigned int initial_count, final_count;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (!pm_get_wakeup_count(&amp;initial_count, true)) //获取initial_count，这个函数会block住，当存在active wakeup source的时候，直到wakeup source为detative状态</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;goto out;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;mutex_lock(&amp;autosleep_lock);</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (!pm_save_wakeup_count(initial_count)) {//保存initial_count，不会block，当然也会检查是否有active wakeup source，当有active存在再次queue work。</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;mutex_unlock(&amp;autosleep_lock);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;goto out;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;}</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (autosleep_state == PM_SUSPEND_ON) {//当为ON状态时，return。//在睡眠期间跟了很久没有遇见过这种情况</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;mutex_unlock(&amp;autosleep_lock);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;}</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (autosleep_state &gt;= PM_SUSPEND_MAX)</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;hibernate();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //hibernate高通平台目前不支持</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;else</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;pm_suspend(autosleep_state); //进入pm_suspend，dmesg会有PM: suspend entry 与PM: suspend exit来标记，这里面会执行freeze task,suspend与resume，disable cpu的操作。内核PM最重要的函数。</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;mutex_unlock(&amp;autosleep_lock);</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (!pm_get_wakeup_count(&amp;final_count, false))//获取final_count，非block,当然也会检查是否有active wakeup source，当有active存在再次queue work</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;goto out;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;/*</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp; * If the wakeup occured for an unknown reason, wait to prevent the</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp; * system from trying to suspend and waking up in a tight loop.</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp; */</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (final_count == initial_count)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //这里遇见未知原因，initial_count与final_count相等，超时500ms后继续往下执行。这种现象我也是跟了许久没有遇见过。</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;schedule_timeout_uninterruptible(HZ / 2);</span><br>  <br>  <span style="font-size:14px">&nbsp;out:</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;queue_up_suspend_work(); //调度queue work会再次执行该函数，实际上只要一次echo mem &gt; sys/power/autosleep后这个进程一直会在auto_sleep cycle。</span><br>  <span style="font-size:14px">}</span><br>  <br>  <br>  <span style="font-size:14px">pm_get_wakeup_count原型,个人感觉这个是仿__wait_event_interruptible（）而写的。</span><br>  <br>  <span style="font-size:14px">bool pm_get_wakeup_count(unsigned int *count, bool block)</span><br>  <span style="font-size:14px">{</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;unsigned int cnt, inpr;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (block) { //当block为真时，该进程可能会block住</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;DEFINE_WAIT(wait);</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for (;;) {</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;prepare_to_wait(&amp;wakeup_count_wait_queue, &amp;wait,</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;TASK_INTERRUPTIBLE);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;split_counters(&amp;cnt, &amp;inpr); //有active的wakeup_source存在就是block住，否则block</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (inpr == 0 || signal_pending(current))</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;break;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;schedule();//在这里面block住，直到最后一个active的wakeup_source deactivate时会唤醒该进程，之后会break出来。</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;finish_wait(&amp;wakeup_count_wait_queue, &amp;wait);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;}</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;split_counters(&amp;cnt, &amp;inpr);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;*count = cnt;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;return !inpr;</span><br>  <span style="font-size:14px">}</span><br>  <br>  <span style="font-size:14px">那么有2个问题，按power键唤醒系统是退出try_to_suspend了吗？</span><br>  <span style="font-size:14px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 首先系统是如何被唤醒的？这个是由硬件中断唤醒的，比如我们这里的power键，还有其他的比如alarm等其他硬件中断，只要我们在中断申请时enbale_irq_wake（），</span><span style="font-size:14px">那么睡眠期间，只要触发该中断就可以唤醒系统。那么在try_to_suspend里面唤醒后pm_suspend（）执行完resume后会退出来，接着会获取final_count，在这里是存在active</span>&nbsp;<span style="font-size:14px">wake_up   source的（在out之前加添的打印active wakeup_source，下面的dmesg证明了存在的wakeup_source），之后执行out,后调度工作队列，再次进入try_to_suspend（），在第一次获取initial_count后便会遇见active wakeup_source，这里面更多的是系统上层加的wakeup_source，那么try_to_suspend()会一直block在pm_get_wakeup_count()里面直到灭屏和所有wakeup_source deactivate时会再次进入pm_suspend（）休眠。</span><br>  <span style="font-size:14px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这里也就解释了为什么只要执行一次ehco mem &gt; sys/power/autosleep后自动可以休眠了的原因。</span><br>  <br>  <span style="font-size:14px">看下面的dmesg:</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp; 928.536418] CPU0: msm_cpu_pm_enter_sleep mode 000000,00000000,00000000,00000000,00000000,00000020,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp; 928.543066] PM: noirq resume of devices complete after 6.020 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp; 928.548512] PM: early resume of devices complete after 2.598 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp; 928.650793] PM: resume of devices complete after 102.266 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp; 928.660290] Restarting tasks ... done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp; 928.681208] PM: suspend exit 1970-01-05 05:23:32.206389881 UTC</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp; 928.681229] active wake lock KeyEvents</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp; 928.681267] active wake lock qpnp_soc_wake</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp; 928.681284] active wake lock alarm, time left 486</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp; 928.681342] active wake lock KeyEvents</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp; 928.681584] active wake lock qpnp_soc_wake</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp; 928.681600] active wake lock alarm, time left 486</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp; 928.696345] request_suspend_state: wakeup at 928691792356 (1970-01-05 05:23:32.221521704 UTC)</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp; 928.708608] mdss_dsi_panel_power on=1</span><br>  <br>  <br>  <br>  <span style="font-size:14px">还有一个与wakeup source无关的问题,为什么suspend后就一直停留在那里不动了？</span><br>  <span style="font-size:14px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这个是cpu停止运转了，下面再分析下代码。</span><br>  <span style="font-size:14px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 核心函数suspend_devices_and_enter（）：</span><br>  <br>  <span style="font-size:14px">/**</span><br>  <span style="font-size:14px">&nbsp;* suspend_devices_and_enter - Suspend devices and enter system sleep state.</span><br>  <span style="font-size:14px">&nbsp;* @state: System sleep state to enter.</span><br>  <span style="font-size:14px">&nbsp;*/</span><br>  <span style="font-size:14px">int suspend_devices_and_enter(suspend_state_t state)</span><br>  <span style="font-size:14px">{</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;int error;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;bool wakeup = false;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (!suspend_ops)</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return -ENOSYS;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;trace_machine_suspend(state);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (suspend_ops-&gt;begin) {</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;error = suspend_ops-&gt;begin(state);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (error)</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;goto Close;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;}</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;suspend_console();</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;suspend_test_start();</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;error = dpm_suspend_start(PMSG_SUSPEND);//这里会执行所有driver的suspend函数，suspend里面有active wakeup_source或者return 为真的话，suspend会报错</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (error) {</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;printk(KERN_ERR &quot;PM: Some devices failed to suspendn&quot;);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;goto Recover_platform;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;}</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;suspend_test_finish(&quot;suspend devices&quot;);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (suspend_test(TEST_DEVICES))</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;goto Recover_platform;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;do {</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;error = suspend_enter(state, &amp;wakeup);//这里会diable cpu</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;} while (!error &amp;&amp; !wakeup</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&amp;&amp; suspend_ops-&gt;suspend_again &amp;&amp; suspend_ops-&gt;suspend_again());</span><br>  <br>  <span style="font-size:14px">&nbsp;Resume_devices:</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;suspend_test_start();</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;dpm_resume_end(PMSG_RESUME);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;suspend_test_finish(&quot;resume devices&quot;);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;resume_console();</span><br>  <span style="font-size:14px">&nbsp;Close:</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (suspend_ops-&gt;end)</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;suspend_ops-&gt;end();</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;trace_machine_suspend(PWR_EVENT_EXIT);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;return error;</span><br>  <br>  <span style="font-size:14px">&nbsp;Recover_platform:</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (suspend_ops-&gt;recover)</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;suspend_ops-&gt;recover();</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;goto Resume_devices;</span><br>  <span style="font-size:14px">}</span><br>  <br>  <br>  <span style="font-size:14px">static int suspend_enter(suspend_state_t state, bool *wakeup)</span><br>  <span style="font-size:14px">{</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;int error;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (suspend_ops-&gt;prepare) {</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;error = suspend_ops-&gt;prepare();</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (error)</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;goto Platform_finish;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;}</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;error = dpm_suspend_end(PMSG_SUSPEND);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (error) {</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;printk(KERN_ERR &quot;PM: Some devices failed to power downn&quot;);</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;goto Platform_finish;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;}</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (suspend_ops-&gt;prepare_late) {</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;error = suspend_ops-&gt;prepare_late();</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (error)</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;goto Platform_wake;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;}</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (suspend_test(TEST_PLATFORM))</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;goto Platform_wake;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;error = disable_nonboot_cpus();&nbsp; //disable nonboot cpu注意还有cpu需要下面disable的</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (error || suspend_test(TEST_CPUS))</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;goto Enable_cpus;</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;arch_suspend_disable_irqs();</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;BUG_ON(!irqs_disabled());</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;error = syscore_suspend();</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (!error) {</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;*wakeup = pm_wakeup_pending();</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (!(suspend_test(TEST_CORE) || *wakeup)) {</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;error = suspend_ops-&gt;enter(state); //在这里cpu会停止运行，直到中断唤醒</span><br>  <span style="font-size:14px">//下面的全部是唤醒的操作了</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;events_check_enabled = false;</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;syscore_resume();</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;}</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;arch_suspend_enable_irqs();</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;BUG_ON(irqs_disabled());</span><br>  <br>  <span style="font-size:14px">&nbsp;Enable_cpus:</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;enable_nonboot_cpus();</span><br>  <br>  <span style="font-size:14px">&nbsp;Platform_wake:</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (suspend_ops-&gt;wake)</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;suspend_ops-&gt;wake();</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;dpm_resume_start(PMSG_RESUME);</span><br>  <br>  <span style="font-size:14px">&nbsp;Platform_finish:</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;if (suspend_ops-&gt;finish)</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;suspend_ops-&gt;finish();</span><br>  <br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;return error;</span><br>  <span style="font-size:14px">}</span><br>  <br>  <span style="font-size:14px">平台赋&#20540;，这里debug平台是基于msm8974的：</span><br>  <span style="font-size:14px">static const struct platform_suspend_ops lpm_suspend_ops = {</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;.enter = lpm_suspend_enter,//在这里面disbale cpu，停止运行程序</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;.valid = suspend_valid_only_mem,</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;.prepare_late = lpm_suspend_prepare,</span><br>  <span style="font-size:14px">&nbsp;&nbsp; &nbsp;.wake = lpm_suspend_wake,</span><br>  <span style="font-size:14px">};</span><br>  <br>  <br>  <span style="font-size:14px">添加显示<span style="color:#000099">wake_lock</span>的dmesg:</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 90.964850] CPU0: msm_cpu_pm_enter_sleep mode 000000,00000000,00000000,00000000,00000000,00000020,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 90.965302] Enabling non-boot CPUs ...</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 90.968303] CPU3 is up</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 90.970699] PM: noirq resume of devices complete after 2.382 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 90.973460] PM: early resume of devices complete after 1.443 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.097369] PM: resume of devices complete after 123.888 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.112858] Restarting tasks ... done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.141699] PM: suspend exit 1970-01-05 03:59:28.158266979 UTC</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.141776] PM: suspend entry 1970-01-05 03:59:28.158347917 UTC</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.141801] PM: Syncing filesystems ... done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.222299] Freezing user space processes ... (elapsed 0.03 seconds) done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.258126] Freezing remaining freezable tasks ... (elapsed 0.02 seconds) done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.278279] Suspending console(s) (use no_console_suspend to debug)</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.384933] PM: suspend of devices complete after 95.062 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.397910] PM: late suspend of devices complete after 12.934 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.413019] PM: noirq suspend of devices complete after 15.064 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.413059] Disabling non-boot CPUs ...</span><br>  <span style="font-size:14px"><span style="color:#000099">&lt;6&gt;[&nbsp;&nbsp; 91.424477] CPU0: msm_cpu_pm_enter_sleep mode 000000,00000000,00000000,00000000,00000000,00000020,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000//这里cpu停止运行直到中断唤醒</span></span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.425144] Enabling non-boot CPUs ...</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.432354] CPU3 is up</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.444416] PM: noirq resume of devices complete after 11.997 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.460948] PM: early resume of devices complete after 10.458 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.577213] PM: resume of devices complete after 116.231 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.584876] Restarting tasks ... done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.614571] PM: suspend exit 1970-01-05 03:59:35.550203849 UTC</span><br>  <span style="font-size:14px"><span style="color:#000099">&lt;6&gt;[&nbsp;&nbsp; 91.614639] active wake lock rmt_storage_-1220268312</span></span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.689912] PM: suspend entry 1970-01-05 03:59:35.625550620 UTC</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.689921] PM: Syncing filesystems ... done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.700706] Freezing user space processes ... </span>  <br>  <span style="font-size:14px">&lt;3&gt;[&nbsp;&nbsp; 91.712870] Freezing of user space&nbsp; aborted</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.712898] </span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.712903] Restarting tasks ... done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.720540] PM: suspend exit 1970-01-05 03:59:35.656175256 UTC</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.720574] PM: suspend entry 1970-01-05 03:59:35.656214579 UTC</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.720586] PM: Syncing filesystems ... done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.801097] Freezing user space processes ... </span>  <br>  <span style="font-size:14px">&lt;3&gt;[&nbsp;&nbsp; 91.815050] Freezing of user space&nbsp; aborted</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.815075] </span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.815083] Restarting tasks ... done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.823603] PM: suspend exit 1970-01-05 03:59:35.759241558 UTC</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.823633] PM: suspend entry 1970-01-05 03:59:35.759272964 UTC</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.823643] PM: Syncing filesystems ... done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.911985] Freezing user space processes ... (elapsed 0.03 seconds) done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.949378] Freezing remaining freezable tasks ... (elapsed 0.01 seconds) done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 91.969089] Suspending console(s) (use no_console_suspend to debug)</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.085594] PM: suspend of devices complete after 98.499 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.098615] PM: late suspend of devices complete after 12.975 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.113909] PM: noirq suspend of devices complete after 15.249 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.113951] Disabling non-boot CPUs ...</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.147320] CPU0: msm_cpu_pm_enter_sleep mode 000000,00000000,00000000,00000000,00000000,00000020,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.148265] Enabling non-boot CPUs ...</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.155121] CPU1 is up</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.163797] CPU2 is up</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.174144] CPU3 is up</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.186556] PM: noirq resume of devices complete after 12.344 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.199945] PM: early resume of devices complete after 10.020 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.317528] PM: resume of devices complete after 117.548 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.326254] Restarting tasks ... done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.342025] PM: suspend exit 1970-01-05 04:00:48.122436614 UTC</span><br>  <span style="color:#000099"><span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.342337] active wake lock qpnp-vadc-f611ac00</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.342357] active wake lock alarm, time left 481</span></span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.411428] PM: suspend entry 1970-01-05 04:00:48.191838905 UTC</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.411451] PM: Syncing filesystems ... done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.419086] Freezing user space processes ... </span>  <br>  <span style="font-size:14px">&lt;3&gt;[&nbsp;&nbsp; 92.431173] Freezing of user space&nbsp; aborted</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.431213] </span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.431225] Restarting tasks ... done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.441575] PM: suspend exit 1970-01-05 04:00:48.221987864 UTC</span><br>  <span style="font-size:14px"><span style="color:#000099">&lt;6&gt;[&nbsp;&nbsp; 92.441709] active wake lock qpnp-vadc-f611ac00</span></span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.445004] PM: suspend entry 1970-01-05 04:00:48.225417551 UTC</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.445026] PM: Syncing filesystems ... done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.525764] Freezing user space processes ... </span>  <br>  <span style="font-size:14px">&lt;3&gt;[&nbsp;&nbsp; 92.541465] Freezing of user space&nbsp; aborted</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.541523] </span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.541545] Restarting tasks ... done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.558768] PM: suspend exit 1970-01-05 04:00:48.339166145 UTC</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.558865] PM: suspend entry 1970-01-05 04:00:48.339268645 UTC</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.558898] PM: Syncing filesystems ... done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.656122] Freezing user space processes ... (elapsed 0.04 seconds) done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.699091] Freezing remaining freezable tasks ... (elapsed 0.01 seconds) done.</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.718891] Suspending console(s) (use no_console_suspend to debug)</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.832084] PM: suspend of devices complete after 97.905 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.845099] PM: late suspend of devices complete after 12.971 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.860407] PM: noirq suspend of devices complete after 15.264 msecs</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.860447] Disabling non-boot CPUs ...</span><br>  <span style="font-size:14px">&lt;6&gt;[&nbsp;&nbsp; 92.895114] CPU0: msm_cpu_pm_enter_sleep mode 000000,00000000,00000000,00000000,00000000,00000020,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000</span><br>  <br>  <br>				
				
				
				<div>
				
				<script type="text/javascript">
				var cpro_id="u2312490";
				(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"740",rsi1:"200",pat:"1",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"0",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"14",rss2:"#000000",titSU:"0",tft:"0",tlt:"1",ptbg:"90",piw:"0",pih:"0",ptp:"0"}
				</script>
				<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>

				</div>
				
				
				<div class="relatelist clr" style="float:left;width:760px;">
					<h4>相关推荐</h4>
					
				
					<div style="float:left;width:400px;">

                                       <div id="hm_t_81316"></div>
                    												                        												                        												                        												                        												                        												                        												                                            </ul>
                  </div>  
				  
				  <div style="float:left;width:290px;">
					<script type="text/javascript">
					var cpro_id="u2288425";
					(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"290",rsi1:"290",pat:"3",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"0",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"16",rss2:"#000000",titSU:"0",tft:"0",tlt:"0"}
					</script>
					<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
					</div>
				  
                </div>


 感谢关注 Ithao123Linux频道，ithao123.cn是专门为互联网人打造的学习交流平台，全面满足互联网人工作与学习需求，更多互联网资讯尽在 IThao123!

            </div>


            <br>
            <div class="realted-artle">
                <div class="list clr">

                    <script type="text/javascript">
					var cpro_id="u2288424";
					(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"760",rsi1:"200",pat:"1",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"0",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"14",rss2:"#000000",titSU:"0",tft:"0",tlt:"1",ptbg:"90",piw:"0",pih:"0",ptp:"0"}
					</script>
					<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>


                </div>
				
				
                </div>
				
				


            <div class="realted-artle">
                <div class="tit">

            		<span class="keyword">
                                                                                        关键词：

                                                                                                                        <a href="http://www.ithao123.cn/tag/autosleep/"  target="_blank">autosleep</a>
                                                                                                                                                                <a href="http://www.ithao123.cn/tag/msm8974/"  target="_blank">msm8974</a>
                                                                                                                                                                <a href="http://www.ithao123.cn/tag/try_to_suspe/"  target="_blank">try_to_suspe</a>
                                                                                                                                           </span>
                </div>
                
                
            </div>

            <br>
            <div style="clear: both;">
            <script type="text/javascript">
    /*在线_ithao123_内容页相关文章下方图片广告_v2_788*100 创建于 2015-08-31*/
    var cpro_id = "u2288428";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>            </div>




            <!-- pageRelate END -->
            <!-- 评论 -->
            <div class="article-coment">




    <div class="lp-comment useComJs" id="lph-comment">
        <input id="lp_item_id" type="hidden" name="item_id" value="46925">
        <input id="lp_item_type" type="hidden" name="type" value="2">

        <div class="h2 clr">
            <h2>文章点评：</h2>
            <!-- <strong class="h2-tip">
                （您需要<a class="c-log" href="javascript:openPop('#lp-login-pop');">登录</a>后才能评论 <a href="http://home.ithao123.cn/main/register" class="c-reg">没有账号</a> ？）</strong>
            -->
        </div>
                <form action="http://www.ithao123.cn/index.php?m=comment&c=index&a=post&commentid=content_81-943843-1" method="post">
        <div class="submit clr" id="commentForm">

            <div class="text">



                    <input type="hidden" name="title" value="W%2Be9rumhtl0NCiAgICAgICAgbGludXjlhoXmoLgzLjTln7rkuo53YWtldXBfc291cmNl55qEYXV0b3NsZWVw5py65Yi25YiG5p6Q">
                                       <input type="hidden" name="url" value="aHR0cDovL3d3dy5pdGhhbzEyMy5jbi9jb250ZW50LTk0Mzg0My5odG1s">
                <input type="hidden" name="module" value="content_81">
                <input type="hidden" name="data_id" value="943843">
                    <input type="hidden" name="direction" value="1" />
                    <a name="comment"></a>
                    <textarea rows="8" cols="80" name="content" id="saytext0"></textarea><br>


            </div>
            <div class="sub clr publishtosina">

                <button type="submit" title="提交">提交</button>
            </div>
        </div>
        </form>

                        
    </div>
</div>
            <!-- 评论 -->

            <div class="idx-selLead clr">
                <div class="tip">
                    <h4><span>精选专题</span></h4>
                </div>
                <div class="list">

            
    <div class="items pr15 mr13 pb15 items-borb clr">
    <div class="pic">
        <a href="http://11.zhuanti.ithao123.cn" target="_blank">
            <img src="http://zhuanti.ithao123.cn/uploadfile/2015/0607/20150607064706838.jpg" alt="Laravel入门教程" width="168" height="112">
        </a>
    </div>
    <div class="txt">
        <div class="tit">
            <a href="http://11.zhuanti.ithao123.cn" target="_blank">Laravel入门教程</a>
        </div>
        <p>Laravel是一套简洁、优雅的PHP Web开发框架(PHP Web Framework)。它可以让你从面条一样杂乱的代码中解脱出来；它可以帮你构建一个完美的网络APP，而且每行代码都可以简洁、富于表达力。</p>
    </div>
</div>
<div class="items-line"></div>

    <div class="items ml14 pl15 pb15 clr  items-borb">
    <div class="pic">
        <a href="http://10.zhuanti.ithao123.cn" target="_blank">
            <img src="http://zhuanti.ithao123.cn/uploadfile/2015/0606/20150606081115788.jpg" alt="hadoop学习及应用" width="168" height="112">
        </a>
    </div>
    <div class="txt">
        <div class="tit">
            <a href="http://10.zhuanti.ithao123.cn" target="_blank">hadoop学习及应用</a>
        </div>
        <p>Hadoop是一个由Apache基金会所开发的分布式系统基础架构。
用户可以在不了解分布式底层细节的情况下，开发分布式程序。充分利用集群的威力进行高速运算和存储。
Hadoop实现了一个分布式文件系统（Hadoop Distributed File System），简称HDFS。HDFS有高容错性的特点，并且设计用来部署在低廉的（low-cost）硬件上；而且它提供高吞吐量（high throughput）来访问应用程序的数据，适合那些有着超大数据集（large data set）的应用程序。HDFS放宽了（relax）POSIX的要求，可以以流的形式访问（streaming access）文件系统中的数据。
Hadoop的框架最核心的设计就是：HDFS和MapReduce。HDFS为海量的数据提供了存储，则MapReduce为海量的数据提供了计算。</p>
    </div>
</div>

    <div class="items pr15 mr13 clr">
    <div class="pic">
        <a href="http://9.zhuanti.ithao123.cn" target="_blank">
            <img src="http://zhuanti.ithao123.cn/uploadfile/2015/0605/20150605112544230.jpg" alt="互联网产品设计" width="168" height="112">
        </a>
    </div>
    <div class="txt">
        <div class="tit">
            <a href="http://9.zhuanti.ithao123.cn" target="_blank">互联网产品设计</a>
        </div>
        <p>产品设计是互联网产品经理的核心能力，一个好的产品经理一定在产品设计方面有扎实的功底，本专题将从互联网产品设计的几个方面谈谈产品设计</p>
    </div>
</div>
<div class="items-line"></div>

    <div class="items ml14 pl15 clr">
    <div class="pic">
        <a href="http://7.zhuanti.ithao123.cn" target="_blank">
            <img src="http://zhuanti.ithao123.cn/uploadfile/2015/0603/20150603100649512.png" alt="产品经理职责" width="168" height="112">
        </a>
    </div>
    <div class="txt">
        <div class="tit">
            <a href="http://7.zhuanti.ithao123.cn" target="_blank">产品经理职责</a>
        </div>
        <p>随着国内互联网的发展，产品经理岗位需求大幅增加，在国内，从事产品工作的大部分岗位为产品经理，其实现实中，很多从事产品工作的岗位是不能称为产品经理，主要原因是对产品经理的职责不明确，那产品经理的职责有哪些，本专题将详细介绍产品经理的主要职责</p>
    </div>
</div>


</div>            </div>


        </div>
        <!-- lph-left -->
        <!-- 只有文章内页才去引用 -->

        <!-- 发送私信 -->

        <!-- # 发送私信-->
        <div class="lph-right">

    <!-- 临时广告begin  -->
    <div class="right-box">
        <script type="text/javascript">
    /*在线_IT_内容页_右侧最新专题上方广告_v2_300*250 创建于 2015-12-21*/
    var cpro_id = "u2458794";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
    </div>
	 
<!--
	<div class="right-box">
        
		<style >
		#slider{overflow:hidden;width:300px;height:300px;position:relative;}
		#slider .pics{width:300px;height:300px}
		#slider .pics li{height:300px;width:300px;float:left}
		#slider #nav {position:absolute;bottom:5px;right:5px;}
		#slider #nav li.nav{background:#F47500; color:#fff;}
		#slider #nav li{border:1px solid #f47500; color:#d94b01; cursor:pointer;background:#fff;font-size:12px; height:15px;width:15px;float:left;margin-left:4px;display:inline;text-align:center}
		</style>		
		<div id="slider">
			<ul class="pics">
		<li><a href="http://www.edu360.cn/" rel="nofollow"><img  src="http://doc.ithao123.cn/d/2016/0111/20160111112314869.jpg" /></a></li>
		<li><a href="http://www.edu360.cn/classroom/21/courses" rel="nofollow"><img src="http://doc.ithao123.cn/d/2016/0111/20160111112440657.jpg" /></a></li>	
			</ul>
			<ul id="nav">
				<li onmouseover="setTimeout(function(){lanrenzhijia.slider.pos(0)},300)">1</li>
				<li onmouseover="setTimeout(function(){lanrenzhijia.slider.pos(1)},300)">2</li>

			</ul>
		</div>
<script>
var lanrenzhijia = {}, H$ = function(id){return document.getElementById(id)}, H$$ = function(c,p){return p.getElementsByTagName(c)}
lanrenzhijia.slider = function(){
	return{
		init:function(id,options){
			var ul = this.u = H$$('ul',H$(id))[0], li = H$$('li',ul); this.l=li.length; this.index = 0;
			if(options.navId&&options.curClass){this.nav = H$$('li',H$(options.navId)), this.c = options.curClass;}
			this.a=options.auto||0; this.v=options.vertical||0;H$(id).style.overflow = 'hidden';H$(id).style.position = 'relative';ul.style.position='absolute';
			if(this.v){ul.style.top=0; this.h=options.height||li[0].offsetHeight; ul.style.height=(this.l*this.h)+'px';}
			else{ul.style.left=0; this.w=options.width||li[0].offsetWidth; ul.style.width=(this.l*this.w)+'px';}
			this.pos(options.index||0,this.a?1:0);
		},
		
		pos:function(pos,a){
			clearInterval(this.u.posAnim); clearInterval(this.u.auto);
			var curPos=this.v?parseInt(this.u.style.top):parseInt(this.u.style.left),
			correctPos=this.v?pos*this.h:pos*this.w, 
			direction = correctPos>Math.abs(curPos)?1:-1;
			correctPos*=-1; 
			this.index = pos;
			if(this.nav){for(var i=0;i<this.l;i++){this.nav[i].className = i==pos?this.c:''}}
			this.u.posAnim = setInterval(function(){lanrenzhijia.slider.anim(correctPos,direction,a)},10);
		},
		
		anim:function(des,dir,a){
			var curPos=this.v?parseInt(this.u.style.top):parseInt(this.u.style.left);
			if(curPos == des){
				clearInterval(this.u.posAnim);
				if(a||this.a){lanrenzhijia.slider.auto()}
			}
			else{
				var v=curPos-Math.ceil(Math.abs(des-curPos)*.07)*dir+'px';
				this.v?this.u.style.top=v:this.u.style.left=v;
			}
		},
		
		auto:function(){
			this.u.auto=setInterval(function(){lanrenzhijia.slider.move(1,1)},this.a*1000)
		},
		
		move:function(n,a){
			var num=this.index+n, i=n==1?num==this.l?0:num:num<0?this.l-1:num; lanrenzhijia.slider.pos(i,a);
		}
	};
}();
</script>
<script>
lanrenzhijia.slider.init('slider',{	
	auto:4,
	vertical:1,
	navId:'nav',
	curClass:'nav',
	index:0});
</script>
		
		

    </div>
	-->

	

    <!-- 右侧专题 -->
    <div class="kuaixun right-box">
    <div class="right-box-title">
        <h3>最新专题</h3>
    </div>
    <ul class="kx-ul">

                                <li class="clr hov">
            <a href="http://199.zhuanti.ithao123.cn" target="_blank">
                <div class="time"><span class="r">22</span>/<span class="y">06月</span> </div>
                <div class="title">android游戏开发教程</div>
            </a>
        </li>
                        <li class="clr">
            <a href="http://198.zhuanti.ithao123.cn" target="_blank">
                <div class="time"><span class="r">22</span>/<span class="y">06月</span> </div>
                <div class="title">webos手机</div>
            </a>
        </li>
                        <li class="clr">
            <a href="http://197.zhuanti.ithao123.cn" target="_blank">
                <div class="time"><span class="r">22</span>/<span class="y">06月</span> </div>
                <div class="title">重庆ios培训</div>
            </a>
        </li>
                        <li class="clr">
            <a href="http://196.zhuanti.ithao123.cn" target="_blank">
                <div class="time"><span class="r">22</span>/<span class="y">06月</span> </div>
                <div class="title">ios开发教程</div>
            </a>
        </li>
                        <li class="clr">
            <a href="http://195.zhuanti.ithao123.cn" target="_blank">
                <div class="time"><span class="r">22</span>/<span class="y">06月</span> </div>
                <div class="title">android应用开发实战</div>
            </a>
        </li>
                        

    </ul>
</div>
    <div class="right-box">
        <script type="text/javascript">
    var cpro_id="u2354052";
    (window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"300",rsi1:"300",pat:"17",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"1",adp:"1",ptt:"0",titFF:"",titFS:"14",rss2:"#000000",titSU:"0"}
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>

    </div>

    <!-- 右侧周刊 -->
    <div class="kuaixun right-box">
    <div class="right-box-title">
        <h3>IThao123周刊</h3>
    </div>
    <ul class="kx-ul">

                                <li class="clr hov">
            <a href="http://200.zhoukan.ithao123.cn" target="_blank">
                <div class="time"><span class="r">14</span>/<span class="y">09月</span> </div>
                <div class="title"> IThao123互联网周刊，互联网资讯不错...</div>
            </a>
        </li>
                        <li class="clr">
            <a href="http://182.zhoukan.ithao123.cn" target="_blank">
                <div class="time"><span class="r">08</span>/<span class="y">09月</span> </div>
                <div class="title"> IThao123互联网周刊，互联网资讯不错...</div>
            </a>
        </li>
                        <li class="clr">
            <a href="http://171.zhoukan.ithao123.cn" target="_blank">
                <div class="time"><span class="r">02</span>/<span class="y">09月</span> </div>
                <div class="title">IThao123互联网周刊，互联网资讯不错过(...</div>
            </a>
        </li>
                        <li class="clr">
            <a href="http://126.zhoukan.ithao123.cn" target="_blank">
                <div class="time"><span class="r">26</span>/<span class="y">08月</span> </div>
                <div class="title"> IThao123互联网周刊，互联网资讯不错...</div>
            </a>
        </li>
                        <li class="clr">
            <a href="http://113.zhoukan.ithao123.cn" target="_blank">
                <div class="time"><span class="r">17</span>/<span class="y">08月</span> </div>
                <div class="title">IThao123互联网周刊，互联网资讯不错过(...</div>
            </a>
        </li>
                        
    </ul>
</div>
    <!-- 临时广告begin   -->


    <div class="right-box">
        <script type="text/javascript">
            /*ithao123_内容页右侧猜您关注上方广告_v2_300*250 创建于 2015-08-13*/
            var cpro_id = "u2288422";
        </script>
        <script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
    </div>

    <!-- 临时广告end -->

    <!-- 猜您关注 -->
    <div class="kuaixun right-box">
    <div class="right-box-title">
        <h3>猜您关注</h3>
    </div>
    <ul class="kx-ul" style="height:415px;" id="guess">
	
	
                                <li class="clr">
            <a href="http://www.ithao123.cn/content-10977403.html" target="_blank">
                查linux开机时间和重启时间            </a>
        </li>
                <li class="clr">
            <a href="http://www.ithao123.cn/content-10977393.html" target="_blank">
                Dubbo分布式服务治理（一）&mdash;...            </a>
        </li>
                <li class="clr">
            <a href="http://www.ithao123.cn/content-10977392.html" target="_blank">
                Dubbo分布式服务治理（二）&mdash;...            </a>
        </li>
                <li class="clr">
            <a href="http://www.ithao123.cn/content-10977350.html" target="_blank">
                linux中的cron            </a>
        </li>
                <li class="clr">
            <a href="http://www.ithao123.cn/content-10977324.html" target="_blank">
                linux下 find 和 grep命令...            </a>
        </li>
                <li class="clr">
            <a href="http://www.ithao123.cn/content-10977312.html" target="_blank">
                linux环境下无阻塞键盘输入以...            </a>
        </li>
                <li class="clr">
            <a href="http://www.ithao123.cn/content-10977311.html" target="_blank">
                linux下使用CmakeLists编译AR...            </a>
        </li>
                <li class="clr">
            <a href="http://www.ithao123.cn/content-10977224.html" target="_blank">
                Linux 两台主机之间建立信任...            </a>
        </li>
                <li class="clr">
            <a href="http://www.ithao123.cn/content-10975254.html" target="_blank">
                linux 互斥锁pthread_mutex_...            </a>
        </li>
                <li class="clr">
            <a href="http://www.ithao123.cn/content-10975114.html" target="_blank">
                正确的处理Linux操作系统里的密码            </a>
        </li>
                <li class="clr">
            <a href="http://www.ithao123.cn/content-10975113.html" target="_blank">
                Linux操作系统网络安全的内在...            </a>
        </li>
                <li class="clr">
            <a href="http://www.ithao123.cn/content-10975097.html" target="_blank">
                如何安装Linux            </a>
        </li>
                <li class="clr">
            <a href="http://www.ithao123.cn/content-10975083.html" target="_blank">
                Linux学习教程            </a>
        </li>
                <li class="clr">
            <a href="http://www.ithao123.cn/content-10975082.html" target="_blank">
                Linuxcmd.chm 命令字典!好用            </a>
        </li>
                <li class="clr">
            <a href="http://www.ithao123.cn/content-10974946.html" target="_blank">
                linux 下个目录介绍            </a>
        </li>
                <li class="clr">
            <a href="http://www.ithao123.cn/content-10974922.html" target="_blank">
                linux下安装使用protocol bu...            </a>
        </li>
                
	    </ul>
</div>
    <div class="right-box" style="border:1px #ccc solid;padding-top:10px;background:#fff;z-index:1000;" id="guessdownad">
        <script type="text/javascript">
            var cpro_id="u2307775";
            (window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"298",rsi1:"300",pat:"6",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"0",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"14",rss2:"#000000",titSU:"0",ptbg:"90",piw:"120",pih:"70",ptp:"0"}
        </script>
        <script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>


    </div>
    <script type="text/javascript">
        $(function() {

            $(window).scroll(function () {
                var scroH = $(window).scrollTop();
                //console.log();
                //var hh = scroH - $('#guessdownad').height();
                var articlelefth = $('.article-left').height();

                if(parseInt(articlelefth) < 2000){
                    return false;
                }

                var oset = $('#guess').offset();
                var hh = oset.top + 400;
                if (scroH >= hh) {
                    $('#guessdownad').css({'position': 'fixed', 'top': '60px'});
                } else {
                    $('#guessdownad').css({'position': 'relative', 'top': 'none'});
                }
            });
        });
    </script>



</div>        <!-- lph-right -->
    </div>
</div>
<!-- index-main END -->

<!-- js END -->
<div class="yp-footer">
    <div class="inner">
        <div class="yp-footer-top clr">

		

            <div class="left">
                <!-- JiaThis Button BEGIN -->
                <div class="jiathis_style_32x32">
                    <a class="jiathis_button_qzone"></a>
                    <a class="jiathis_button_tsina"></a>
                    <a class="jiathis_button_tqq"></a>
                    <a class="jiathis_button_weixin"></a>
                    <a class="jiathis_button_renren"></a>
                    <a rel="nofollow" href="http://www.jiathis.com/share?uid=1951562" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
                    <a class="jiathis_counter_style"></a>
                </div>
                <script type="text/javascript">
                    var jiathis_config = {data_track_clickback:'true'};
                </script>
                <script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405996127865441" charset="utf-8"></script>
                <!-- JiaThis Button END -->
            </div>

            <div class="right clr">
                <div class="links">
                    <a rel="nofollow" href="http://www.ithao123.cn/about.html">关于我们</a>|
                    <a rel="nofollow" href="http://www.ithao123.cn/mianze.html">免责声明</a>|
                    <a rel="nofollow" href="http://www.ithao123.cn/guanggao.html">广告服务</a>|
                    <a rel="nofollow" href="http://www.ithao123.cn/lianxi.html">联系我们</a>
                </div>

            </div>
        </div>

        <div class="yp-footer-btm">


            						
			
			
            

        </div>
    </div>
    <div class="yp-copyright">

    <div class="inner">
        <p>
            Copyright © 2011-2015 www.ithao123.cn IThao123.cn - IT行业第一站 All Rights Reserved 琼ICP备14001398号-3
        </p>
    </div>
</div>

<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?8c1ae9ead8d05148084aa256a8a8f7eb";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

<script>

(function(){

    var bp = document.createElement('script');

    bp.src = '//push.zhanzhang.baidu.com/push.js';

    var s = document.getElementsByTagName("script")[0];

    s.parentNode.insertBefore(bp, s);

})();

</script>
</div>

<div class="gotoBar" id="lph-footer-gotoBar">

    <a class="top" rel="nofollow" href="javascript:;" data-goto="0" data-start="100" title="返回顶部" style="display: none;"></a>
    <!--
    <a class="sugg" href="#" target="_self"><span>意见<br>反馈</span></a>
    -->
</div>

<script type="text/javascript">
    /*在线_IT_内容页_视窗广告_v2_250*200 创建于 2015-09-24*/
var cpro_id = "u2326271";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/f.js" type="text/javascript"></script>



<script type="text/javascript">
    /*在线_IT_内容页_对联广告_v2 创建于 2015-11-30*/
var cpro_id = "u2425466";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/f.js" type="text/javascript"></script>

<!--
<script>QIHOO_UNION_F_SLOT={w:120, h:270, ls:"s659ea92592",position:3, display:0,origin:2};</script><script src="http://s.lianmeng.360.cn/so/f.js" charset="utf-8"></script>
-->

<!--对联
<script src="http://ji.dazhantai.com/cpv/i.php?z=5961"></script>
-->



<!-- 遮罩层 -->
</body></html>